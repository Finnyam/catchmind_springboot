<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.springboot.catchmind.repository.ShopMapper">
    <select id="select" parameterType="map" resultType="com.springboot.catchmind.dto.ShopDto">
        SELECT SID, ROLEID, SCREATEDATE, SDELETEYN, ACONFIRMYN, ACONFIRMFINALYN, SCONFIRMYN,
               SPASS, SNAME, SPHONE, SLOC, SLOCSHORT, SINTRO, SMODIFYDATE, SOPENINGHOUR,
               SCLOSINGHOUR, SCLOSINGDATE, SDEPOSIT, SMEALFEE, LUNCH, DINNER
            FROM SHOP
            WHERE SCONFIRMYN=#{sconfirm}
              AND ACONFIRMFINALYN=#{aconfirmfinal}
    </select>

    <insert id="insert" parameterType="com.springboot.catchmind.dto.ShopDto">
        INSERT INTO SHOP(SID, ROLEID, SCREATEDATE, SDELETEYN, ACONFIRMYN, ACONFIRMFINALYN, SCONFIRMYN,
                         SPASS, SNAME, SPHONE, SFOODSTYLE, SLOC, SLOCX, SLOCY, SLOCSHORT, SMPHOTO)
            VALUES('S_'||LTRIM(TO_CHAR(SEQU_SHOP_SID.NEXTVAL,'0000')), 'SHOP', SYSDATE, 'N', 'Y', 'N', 'N',
                   #{spass}, #{sname}, #{sphone}, #{sfoodstyle}, #{sloc}, #{slocx}, #{slocy}, #{slocshort}, #{smphoto})
    </insert>

    <select id="selectSpass" resultType="String">
        SELECT DBMS_RANDOM.STRING('L',10)||CEIL(DBMS_RANDOM.VALUE(10000,99999)) SPASS
            FROM DUAL
    </select>

    <select id="selectSpassCheck" parameterType="String" resultType="Integer">
        SELECT COUNT(*)
            FROM SHOP
            WHERE SPASS=#{spass}
    </select>

    <select id="shopInfoSelect" parameterType="String" resultType="com.springboot.catchmind.dto.ShopDto">
        select sid, roleid, screatedate, sdeleteyn, aconfirmyn, aconfirmfinalyn,
                sconfirmyn, spass, sname, sphone, sloc, slocx, slocy, slocshort, sintro,
                smodifydate, sclosingdate, sopeninghour, sclosinghour,
                sdeposit, smealfee, lunch, dinner, swebsite, sfoodstyle, smphoto
            from shop
            where sid = #{sid}
    </select>

    <select id="facilitySelect" parameterType="String" resultType="com.springboot.catchmind.dto.FacilityDto">
        SELECT PARKING, VALET, CORKAGE, ADULTONLY, SOMMELIER, LETTERING, RENTALS,
               SID, PARKINGDESC, VALETDESC, CORKAGEDESC, ADULTONLYDESC, SOMMELIERDESC, LETTERINGDESC, RENTALSDESC
            FROM FACILITY
            WHERE SID=#{sid}
    </select>

    <select id="photoSelect" parameterType="String" resultType="com.springboot.catchmind.dto.ShopPhotoDto">
        select sid, photo1, photo2, photo3, photo4, photo5,
		        sphoto1, sphoto2, sphoto3, sphoto4, sphoto5
		    from shop_photo
			where sid=#{sid}
    </select>
</mapper>